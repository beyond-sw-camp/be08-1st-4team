> # 팀 COMMIT

![커밋 베너](https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/144869429/df644c10-cab5-4ed8-a1e4-566d9f04387d)



# 🐸 프로젝트 멤버

|<img src="https://github.com/kanghana1/RideTogetherHYU_BE/assets/107329874/78c03ba2-f2c6-4d96-9ae9-9e3276c8a7a3" width="160" height="150"/>|<img src="https://github.com/kanghana1/RideTogetherHYU_BE/assets/107329874/05c30e5c-2398-4607-abe3-7950ed114719" width="160" height="150"/>|<img src="https://github.com/kanghana1/RideTogetherHYU_BE/assets/107329874/5d91160f-23c1-4c30-9808-002706ef715e" width="160" height="150"/>|<img src="https://avatars.githubusercontent.com/u/107329874?v=4" width="160" height="150"/>|<img src="https://github.com/kanghana1/RideTogetherHYU_BE/assets/107329874/2f170cdf-cef9-4ec0-9035-c77b742cde0e" width="160" height="150"/>|
|:-:|:-:|:-:|:-:|:-:|
|🌽계용운🌽<br/>[@yongun2](https://github.com/yongun2) | 🫐윤호연🫐<br/>[@hoyeon96](https://github.com/hoyeon96) | 🥬서현지🥬<br/>[@henhen7](https://github.com/henhen7) | 🥔강하나🥔<br/>[@kanghana1](https://github.com/kanghana1)|🥕이주희🥕<br/>[@juhi0916](https://github.com/juhi0916)



<br>

# ✨ 프로젝트 설명


StudyHour : COMMIT to Success;
안녕하세요🐸 COMMIT조입니다.
여러분들은 스터디앱을 사용해본적 있으신가요?


![개요](https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/144869429/7abfe76b-ec6f-4c3c-be86-f55561bd5558)

많은 사람들에게 관심을 받고 꾸준히 신규앱에서는 AI 도입, 금전적 보상 등을 도입하고 있습니다.

COMMIT은 많은 사람들이 자신의 목표에 다가갈 수 있도록 커뮤니티 기능, 동기부여 기능 등을 추가하였습니다.

효율적이고 스마트한 학습을 도와주는 StudyHour을 소개합니다.


🔷 맞춤형 학습 플래너

스터디앱은 여러분의 학습 스타일과 목표에 맞춘 맞춤형 학습 플래너를 제공합니다. 
목표에 최적화된 일일, 주간 목표를 설정할 수 있습니다.

🔷 강력한 학습 도구

타이머 기능을 활용하여 집중력을 높이고 효율적인 학습 시간을 관리할 수 있습니다.

🔷 실시간 협업 기능

친구들과 함께 스터디 그룹을 만들어 학습할 수 있습니다. 실시간 채팅, 파일 공유,
공동 노트 작성 기능을 통해 효율적인 그룹 스터디를 진행할 수 있습니다.

🔷 성과 추적 및 분석

팀원들과 학습에 대한 계획을 서로 이모티콘으로 소통하여 보다 효과적인 학습 전략을 세울 수 있습니다.

🔷 학습 동기부여

자율적으로 미이행시 벌금 부여 방식을 적용하여 학습 동기부여를 만들 수 있습니다.

🔷 게시판 및 댓글 기능

스터디앱은 사용자들이 서로 소통하고 정보를 공유할 수 있는 게시판 기능을 제공합니다.
커뮤니티를 형성하고, 서로의 지식을 나누며 함께 성장할 수 있습니다.

StudyHour과 함께라면 학습이 더 이상 어렵지 않습니다. 
StudyHour, 당신의 학습을 혁신하다.


<br>

---

# 📌 프로젝트 목표

1. **서비스 기획 및 기능 명세서 작성**: 서비스에 대한 전반적인 이해와 파악을 위해 서비스 기획과 기능 명세서를 작성한다.
2. **ER 다이어그램 작성**: 서비스에 필요한 데이터베이스의 논리적 구조를 표현하기 위해 ER 다이어그램을 작성합니다.
3. **데이터베이스 논리적 모델링**: ER 다이어그램을 바탕으로 데이터베이스의 논리적 모델을 설계한다.
4. **데이터베이스 물리적 모델링**: 논리적 모델을 기반으로 실제 데이터베이스의 물리적 구조를 정의한다.
5. **데이터베이스 테스트**: 다양한 테스트 데이터를 사용하여 배포 전 데이터베이스를 철저히 테스트하여 안정적인 배포를 수행한다.
6. **데이터베이스 서버 배포**: Ubuntu 운영체제와 MariaDB 데이터베이스를 기반으로 데이터베이스 서버를 배포한다.

---
## 📚 기술 스택

&nbsp;&nbsp;&nbsp;&nbsp;<img src="https://img.shields.io/badge/GitHub-181717?style=flat&logo=GitHub&logoColor=white&color=black"></a></a>
&nbsp;&nbsp;&nbsp;&nbsp;<img src="https://img.shields.io/badge/Git-F05032?style=flat&logo=Git&logoColor=white&color=ffa500"></a></a>
&nbsp;&nbsp;&nbsp;<img src="https://img.shields.io/badge/MariaDB-003545?style=flat&logo=MariaDB&logoColor=white"/></a>
<br>

---
<br>

# 🐧 프로젝트 구현

> ## 🏢 **기능 명세서**

> #### 유저 
> <img width="1108" alt="스크린샷 2024-05-31 오후 1 54 30" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/eeb32737-972f-4c54-9660-575afe9222bb">

> #### 스터디룸
> ![Screenshot_20240531_140908_Sheets](https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/52b2a224-5fef-4a79-8b21-07afa2bf0b78)

> #### 주간 계획 
> <img width="1115" alt="스크린샷 2024-05-31 오후 1 55 15" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/d7ae4853-2614-4fd9-9765-b81a56d19304">

> #### 주간 계획 인증
> <img width="1111" alt="스크린샷 2024-05-31 오후 1 55 41" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/4b25a1db-878f-4947-bcd7-dbda02c3ed27">

> #### 투 두 리스트 
> <img width="1112" alt="스크린샷 2024-05-31 오후 1 55 25" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/b46e8ccf-d3c3-46f3-b138-fd50a6151bd4">

> #### 게시판 
> <img width="1115" alt="스크린샷 2024-05-31 오후 1 55 51" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/7dfa6e21-e424-4b03-b04b-0d3b6bf18e07">

> #### 타이머
> <img width="1113" alt="스크린샷 2024-05-31 오후 1 56 01" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/2b254430-0583-485b-b442-1551b3496b66">

> #### 벌금
> <img width="1114" alt="스크린샷 2024-05-31 오후 1 56 08" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/3c390cdd-784c-4b7a-8b4c-140b0a400ba4">

> #### 통계
> <img width="1114" alt="스크린샷 2024-05-31 오후 1 56 18" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/5418a8e7-6254-4ac4-99ca-19cc9a7b3c4d">

> ### **E-R Diragram**
>> ![Beyond-Sw-Camp-DB-프로젝트](https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/6ec48a09-ce2d-48bd-9f77-378e57521a9a)
>> ![Beyond-Sw-Camp-DB-프로젝트 (1)](https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/65017d15-e004-481a-8acb-db98244c17cc)


> ## **⚡논리적 모델링**
> <img width="1067" alt="스크린샷 2024-05-31 오후 1 48 25" src="https://github.com/beyond-sw-camp/be08-1st-commit-studyhour/assets/76439014/bfd1bd46-ff87-403a-a1ee-7365ba1ea61e">

> ## **📖DDL**
> #### 컬럼명 컨벤션
> 1. pk는  [테이블 physical name]_id 로 통일
> 2. date 타입은 마지막을 _date, datetime은 마지막을 date_time
> 3. 컬럼명 줄이지 말고 최대한 풀어서 쓰기
> 4. pk를 제외한 속성에는 가능하면 테이블 이름 포함 안하기
> 5. 아이디 : username
> 6. 닉네임 : nickname

```sql
USE study_hour;

-- 외래 키 제약 조건 비활성화
SET FOREIGN_KEY_CHECKS = 0;
DROP TABLE IF EXISTS USER;
DROP TABLE IF EXISTS USER_PROFILE;
DROP TABLE IF EXISTS STUDY_ROOM_MEMBER;
DROP TABLE IF EXISTS STUDY_ROOM_MEMBER_TODO;
DROP TABLE IF EXISTS STUDY_ROOM_MEMBER_FINE;
DROP TABLE IF EXISTS STUDY_ROOM_MEMBER_WEEKLY_PLAN_EVALUATION;
DROP TABLE IF EXISTS STUDY_ROOM;
DROP TABLE IF EXISTS STUDY_ROOM_CATEGORY;
DROP TABLE IF EXISTS STUDY_ROOM_BOARD;
DROP TABLE IF EXISTS STUDY_ROOM_BOARD_COMMENT;
DROP TABLE IF EXISTS STUDY_ROOM_MEMBER_WEEKLY_PLAN;
DROP TABLE IF EXISTS STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION;
DROP TABLE IF EXISTS STATISTICS;
-- 외래 키 제약 조건 활성화
SET FOREIGN_KEY_CHECKS = 1;
# CREATE TABLE `STATISTICS`
# (
#     `study_room_id`    INT          NOT NULL,
#     `participant_id`   INT          NOT NULL,
#     `study_room_round` INT          NOT NULL,
#     `attendance`       VARCHAR(255) NULL,
#     `todo_achievement` VARCHAR(255) NULL,
#     `pay_fine`         VARCHAR(255) NULL
# );


CREATE TABLE `USER`
(
    `user_id`  INT PRIMARY KEY AUTO_INCREMENT,
    `username` VARCHAR(15) UNIQUE NOT NULL,
    `password` VARCHAR(64)        NOT NULL,
    `nickname` VARCHAR(10) UNIQUE NOT NULL,
    `gender`   ENUM ('M','F')     NOT NULL
);

CREATE TABLE `USER_PROFILE`
(
    `user_profile_id`   INT PRIMARY KEY AUTO_INCREMENT,
    `user_id`           INT          NOT NULL,
    `age`               TINYINT      NULL,
    `interest`          VARCHAR(255) NULL,
    `state_message`     VARCHAR(100) NULL,
    `profile_image_url` VARCHAR(255) NULL,
    FOREIGN KEY (user_id) REFERENCES USER (user_id)
);

CREATE TABLE `STUDY_ROOM_MEMBER`
(
    `study_room_member_id` INT PRIMARY KEY AUTO_INCREMENT,
    `user_id`              INT                        NOT NULL,
    `study_room_id`        INT                        NOT NULL,
    `is_join_accepted`     BOOLEAN                    NOT NULL,
    `privilege`            ENUM ('MANAGER', 'MEMBER') NULL DEFAULT NULL,
    `join_date_time`       TIMESTAMP                  NOT NULL,
    FOREIGN KEY (user_id) REFERENCES USER (user_id),
    FOREIGN KEY (study_room_id) REFERENCES STUDY_ROOM_MEMBER (study_room_member_id)
);

CREATE TABLE `STUDY_ROOM_MEMBER_FINE`
(
    `study_room_member_fine_id` INT PRIMARY KEY AUTO_INCREMENT,
    `study_room_member_id`      INT NOT NULL,
    `get_fine_round`            INT NOT NULL,
    `fine_amount`               INT NOT NULL DEFAULT 0 CHECK (fine_amount BETWEEN 0 AND 100000),
    FOREIGN KEY (study_room_member_id) REFERENCES STUDY_ROOM_MEMBER (study_room_member_id)
);



CREATE TABLE `STUDY_ROOM_MEMBER_TODO`
(
    `study_room_member_todo_id` INT PRIMARY KEY AUTO_INCREMENT,
    `study_room_member_id`      INT          NOT NULL,
    `content`                   VARCHAR(200) NULL,
    `created_date`              DATE         NOT NULL,
    `is_checked`                BOOLEAN      NOT NULL DEFAULT FALSE,
    FOREIGN KEY (study_room_member_id) REFERENCES STUDY_ROOM_MEMBER (study_room_member_id)
);

CREATE TABLE STUDY_ROOM_CATEGORY
(
    study_room_category_id INT PRIMARY KEY AUTO_INCREMENT,
    name                   VARCHAR(24) UNIQUE NOT NULL
);

CREATE TABLE `STUDY_ROOM`
(
    `study_room_id`          INT PRIMARY KEY AUTO_INCREMENT,
    `study_room_category_id` INT                    NOT NULL,
    `name`                   VARCHAR(30)            NOT NULL,
    `is_public`              boolean                NOT NULL,
    `private_password`            VARCHAR(64)           NULL,
    `description`            VARCHAR(500)           NULL,
    `max_capacity`           TINYINT                NOT NULL CHECK (max_capacity BETWEEN 2 AND 30),
    `authentication_method`  ENUM ('TIME', 'PHOTO') NOT NULL,
    `fine`                   INT                    NOT NULL DEFAULT 0 CHECK ((fine BETWEEN 0 AND 100000) AND (fine % 1000 = 0)),
    `current_study_round`    INT                    NOT NULL DEFAULT 1,
    `start_date_time`        TIMESTAMP              NOT NULL,
    `end_date_time`          TIMESTAMP              NOT NULL,
    `created_date_time`      TIMESTAMP              NOT NULL,
    `is_finished`            BOOLEAN                NOT NULL DEFAULT TRUE,
    FOREIGN KEY (study_room_category_id) REFERENCES STUDY_ROOM_CATEGORY (study_room_category_id)
);

CREATE TABLE `STUDY_ROOM_BOARD`
(
    `study_room_board_id`  INT PRIMARY KEY AUTO_INCREMENT,
    `study_room_id`        INT           NOT NULL,
    `study_room_member_id` INT           NOT NULL,
    `title`                VARCHAR(50)   NOT NULL,
    `content`              VARCHAR(1000) NOT NULL,
    `created_date_time`    TIMESTAMP     NOT NULL,
    FOREIGN KEY (study_room_id) REFERENCES STUDY_ROOM (study_room_id),
    FOREIGN KEY (study_room_member_id) REFERENCES STUDY_ROOM_MEMBER (study_room_member_id)
);

CREATE TABLE `STUDY_ROOM_BOARD_COMMENT`
(
    `study_room_board_comment_id` INT PRIMARY KEY AUTO_INCREMENT,
    `study_room_board_id`         INT          NOT NULL,
    `study_room_member_id`        INT          NOT NULL,
    `content`                     VARCHAR(200) NOT NULL,
    `created_date_time`           TIMESTAMP    NOT NULL,
    FOREIGN KEY (study_room_board_id) REFERENCES STUDY_ROOM_BOARD (study_room_board_id),
    FOREIGN KEY (study_room_member_id) REFERENCES STUDY_ROOM_MEMBER (study_room_member_id)
);

CREATE TABLE `STUDY_ROOM_MEMBER_WEEKLY_PLAN`
(
    `study_room_member_weekly_plan_id` INT PRIMARY KEY AUTO_INCREMENT,
    `study_room_id`                    INT          NOT NULL,
    `study_room_member_id`             INT          NOT NULL,
    `plan_detail`                      VARCHAR(500) NULL,
    `plan_duration`                    INT          NULL,
    `created_date_time`                TIMESTAMP    NOT NULL,
    `weekly_plan_round_number`         INT          NOT NULL,
    FOREIGN KEY (study_room_id) REFERENCES STUDY_ROOM (study_room_id),
    FOREIGN KEY (study_room_member_id) REFERENCES STUDY_ROOM_MEMBER (study_room_member_id)
);

CREATE TABLE `STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION`
(
    `study_room_member_weekly_plan_verification_id` INT PRIMARY KEY AUTO_INCREMENT,
    `study_room_member_weekly_plan_id`              INT          NOT NULL,
    `image_url`                                     VARCHAR(255) NULL,
    `create_date_time`                              TIMESTAMP    NOT NULL,
    FOREIGN KEY (study_room_member_weekly_plan_id) REFERENCES STUDY_ROOM_MEMBER_WEEKLY_PLAN (study_room_member_weekly_plan_id)
);

CREATE TABLE `STUDY_ROOM_MEMBER_WEEKLY_PLAN_EVALUATION`
(
    `study_room_member_weekly_plan_evaluation_id` INT PRIMARY KEY AUTO_INCREMENT,
    `study_room_member_weekly_plan_id`            INT        NOT NULL,
    `study_room_member_id`                        INT        NOT NULL,
    `evaluation_date_time`                        TIMESTAMP  NOT NULL,
    `evaluation_icon`                             VARCHAR(2) NOT NULL,
    FOREIGN KEY (study_room_member_weekly_plan_id) REFERENCES STUDY_ROOM_MEMBER_WEEKLY_PLAN (study_room_member_weekly_plan_id),
    FOREIGN KEY (study_room_member_id) REFERENCES STUDY_ROOM_MEMBER (study_room_member_id)
);
```

# 🐸 테스트 케이스 생성
> ## **유저**
<details>
<summary>신규 회원 가입</summary>
<div markdown="1">

```sql

    # [1.3] [신규 회원 가입] T
    INSERT INTO `USER` (username, password, nickname, gender) VALUES
    ('hoya', '1q2w3e4r!', 'hwsc', 'M');
```

</div>
</details>

<details>
<summary>회원 탈퇴</summary>
<div markdown="1">

```sql

    use study_hour;

-- 게시판, 댓글 테이블은 살린다.
-- 탈퇴자에 대한 주간 계획, 평가, 인증, 벌금 테이블 삭제
DELIMITER $$
CREATE OR REPLACE TRIGGER DELETE_LEAVING_MEMBER_HISTORY
    AFTER UPDATE
    ON USER
    FOR EACH ROW
BEGIN
    IF NEW.username LIKE '탈퇴%' AND NEW.nickname LIKE '탈퇴%'
    THEN
        -- 탈퇴 유저 주간 계획 인증 삭제
        DELETE
        FROM STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION
        WHERE study_room_member_weekly_plan_id in (SELECT p.study_room_member_weekly_plan_id
                                                   FROM STUDY_ROOM_MEMBER m
                                                            INNER JOIN STUDY_ROOM_MEMBER_WEEKLY_PLAN p
                                                                       ON m.study_room_member_id = p.study_room_member_id
                                                   WHERE m.user_id = OLD.user_id);

        -- 탈퇴 유저 주간 계획에 대한 평가 삭제
        DELETE
        FROM STUDY_ROOM_MEMBER_WEEKLY_PLAN_EVALUATION
        WHERE study_room_member_weekly_plan_id IN (SELECT p.study_room_member_weekly_plan_id
                                                   FROM STUDY_ROOM_MEMBER m
                                                            INNER JOIN STUDY_ROOM_MEMBER_WEEKLY_PLAN p
                                                                       ON m.study_room_member_id = p.study_room_member_id
                                                   WHERE m.user_id = OLD.user_id);

        -- 탈퇴 유저 주간 계획 삭제
        DELETE
        FROM STUDY_ROOM_MEMBER_WEEKLY_PLAN
        WHERE study_room_member_id = (SELECT m.study_room_member_id
                                      FROM STUDY_ROOM_MEMBER m
                                      WHERE m.user_id = OLD.user_id);

        -- 탈퇴 유저 벌금 삭제
        DELETE
        FROM STUDY_ROOM_MEMBER_FINE
        WHERE study_room_member_id in (SELECT m.study_room_member_id
                                       FROM STUDY_ROOM_MEMBER m
                                       WHERE m.user_id = OLD.user_id);

        -- 탈퇴 유저 투두 삭제
        DELETE
        FROM STUDY_ROOM_MEMBER_TODO
        WHERE STUDY_ROOM_MEMBER_TODO.study_room_member_id in (SELECT t.study_room_member_id
                                                              FROM STUDY_ROOM_MEMBER m
                                                                       INNER JOIN STUDY_ROOM_MEMBER_TODO t
                                                                                  ON m.study_room_member_id = t.study_room_member_id
                                                              WHERE m.user_id = OLD.user_id);
    END IF;
END $$
DELIMITER ;

# 탈퇴 처리 테스트용 더미 데이터 추가
INSERT INTO USER (username, password, nickname, gender)
VALUES ('탈퇴 유저 1', '1234', '탈퇴 닉네임 1', 'M'),
       ('탈퇴 유저 2', '1234', '탈퇴 닉네임 2', 'M');

# 'Giselbert 유저 탈퇴'
UPDATE USER
SET username = CONCAT('탈퇴 유저 ', (SELECT COUNT(*) + 1 AS 'NEXT_COUNT'
                                 FROM USER
                                 WHERE username LIKE '탈퇴 유저%'
                                   AND nickname LIKE '탈퇴 닉네임%')),
    nickname = CONCAT('탈퇴 닉네임 ', (SELECT COUNT(*) + 1 AS 'NEXT_COUNT'
                                  FROM USER
                                  WHERE username LIKE '탈퇴 유저%'
                                    AND nickname LIKE '탈퇴 닉네임%')),
    password = NULL,
    gender   = NULL
WHERE username = 'Giselbert';

SELECT *
FROM USER;


SELECT *
FROM STUDY_ROOM_MEMBER m
         INNER JOIN USER u ON m.user_id = u.user_id
         LEFT JOIN STUDY_ROOM_MEMBER_TODO todo ON m.study_room_member_id = todo.study_room_member_id
         LEFT JOIN STUDY_ROOM_MEMBER_FINE fine ON m.study_room_member_id = fine.study_room_member_id
         LEFT JOIN STUDY_ROOM_MEMBER_WEEKLY_PLAN plan ON m.study_room_member_id = plan.study_room_member_id
         LEFT JOIN STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION v
                   ON plan.study_room_member_weekly_plan_id = v.study_room_member_weekly_plan_id
WHERE m.study_room_id = 1
  AND username LIKE '탈퇴%';

```

</div>
</details>

> ## **스터디룸**
<details>
<summary>스터디룸 생성</summary>
<div markdown="1">

```sql

-- 12번 유저가 '당근마켓 클론 프로젝트'라는 이름의 스터디룸 개설 (비공개)
INSERT INTO study_room (study_room_category_id, `name`, is_public, private_password, `description`, 
								max_capacity, start_date_time, end_date_time, created_date_time, is_finished) VALUES
(3,'당근마켓 클론 프로젝트',0,'asdf1020','당근마켓 클론 프로젝트 모임입니다.', 
6, '2024-06-01 12:12:13', '2024-12-06 05:00:00', '2024-05-31 17:12:31', FALSE);

-- 스터디룸 생성하면서 동시에 스터디룸 멤버에 방장으로써 데이터 삽입되어야함
INSERT INTO study_room_member (user_id, study_room_id, is_join_accepted, privilege, join_date_time)
VALUES (12, 3, 1, 'MANAGER', '2024-05-31 17:12:31');

```

</div>
</details>

<details>
<summary>스터디룸 정보 수정</summary>
<div markdown="1">

```sql

--	3번 스터디룸 비밀번호 변경 및 인원수 조정, 벌금 추가
UPDATE study_room
SET	private_password = '',
		max_capacity = 7,
		fine = 1000
WHERE study_room_id = 3;

-- * 스터디룸 생성하면서 동시에 스터디룸 멤버에 방장으로써 데이터 삽입되어야함
INSERT INTO study_room_member (user_id, study_room_id, is_join_accepted, privilege, join_date_time) VALUES
(12, 3, 1, 'MANAGER','2024-05-31 17:12:31');

```

</div>
</details>

<details>
<summary>스터디룸 참가 신청</summary>
<div markdown="1">

```sql

# [2.3.1] [공개 스터디룸 참가 신청] T
-- 13번 유저 1번 스터디룸 참가 신청
INSERT INTO study_room_member (user_id, study_room_id, is_join_accepted, join_date_time) VALUES
(13, 1, 0, '2024-06-01 11:00:20');

# [2.4.1] [스터디룸 참가 신청내역 조회] T
-- 1번 스터디룸 참가 신청 내역 조회(1번 스터디룸 방장)
SELECT u.nickname,
		 u.gender,
		 up.profile_image_url,
		 srm.join_date_time
FROM study_room_member srm
INNER JOIN `user` u ON srm.user_id = u.user_id
LEFT OUTER JOIN user_profile up ON u.user_id = up.user_id
WHERE is_join_accepted = 0
AND study_room_id = 1
;

# [2.4.2] [스터디룸 참가 신청 수락] T
-- 아이디 hoya 유저(user_id = 13) 신청 가입 허가
UPDATE study_room_member
SET is_join_accepted = 1,
 	 privilege = 'MEMBER'
WHERE user_id = ( SELECT user_id FROM `user` WHERE `nickname` = 'hwsc' );


# [2.4.3] [스터디룸 참가 신청 거부] T
-- 삭제 케이스를 위해 신청 내역 추가(nickname = Walczak)
INSERT INTO study_room_member (user_id, study_room_id, is_join_accepted, join_date_time) VALUES
(5, 1, 0, '2024-06-01 11:00:20');

SELECT * 
FROM study_room_member;

-- 5번 유저(Neddy)의 1번 스터디룸 참가 신청을 거부함에 따른 삭제
DELETE
FROM study_room_member
WHERE privilege IS NULL
AND study_room_id = 1
AND user_id = (SELECT user_id FROM `user` WHERE `nickname` = 'Walczak')
;

SELECT * 
FROM study_room_member;

```

</div>
</details>

<details>
<summary>스터디룸 전체 목록 조회</summary>
<div markdown="1">

```sql

# [2.5.1] [스터디룸 전체 조회 (전체 조회 화면)] T
SELECT r.`name`, r.is_public, r.`description`, r.max_capacity, c.`name` AS 'category'
FROM study_room r
INNER JOIN study_room_category c ON c.study_room_category_id = r.study_room_category_id
ORDER BY created_date_time DESC, is_finished ASC;

# [2.5.2] [스터디룸 필터링 조회] T
-- 진행중인 공개 스터디룸 조회
SELECT r.`name`, 
		 r.is_public,
		 r.`description`, 
		 r.max_capacity, 
		 c.`name` AS 'category',
		 r.created_date_time,
		 r.end_date_time,
FROM study_room r
INNER JOIN study_room_category c ON c.study_room_category_id = r.study_room_category_id
WHERE r.is_public = 1
AND 	r.end_date_time >= NOW()
;

# [2.5.3] [스터디룸 상세 조회] T
-- 2번 스터디룸 상세 조회
-- id 컬럼 제외 모든 컬럼 조회할 수 있도록 프로시저 생성
DELIMITER $$

CREATE OR REPLACE PROCEDURE select_study_room(
	IN id INT(11)
)
BEGIN
    DECLARE columns_list VARCHAR(1000);

    -- Construct the column list excluding `study_room_id`
    SELECT GROUP_CONCAT(CONCAT('r.', COLUMN_NAME) SEPARATOR ', ')
    INTO columns_list
    FROM INFORMATION_SCHEMA.COLUMNS
    WHERE TABLE_NAME = 'study_room'
    AND COLUMN_NAME != 'study_room_id'
    AND COLUMN_NAME != 'study_room_category_id';

    -- Construct the query
    SET @query = CONCAT('SELECT c.`name` AS category, ', columns_list, 
                        ' FROM study_room r INNER JOIN study_room_category c ',
                        ' ON c.study_room_category_id = r.study_room_category_id ',
                        ' WHERE r.study_room_id = ', id);

    -- Execute the query
    PREPARE stmt FROM @query;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
END $$

DELIMITER ;

-- 프로시저 호출
CALL select_study_room(2);

```

</div>
</details>

<details>
<summary>마이 스터디룸 조회</summary>
<div markdown="1">

```sql

-- is_join_accepted로 스터디그룹 참여 가능 여부가 갈림

-- starla가 마이 스터디룸 서비스를 이용한다고 가정
-- [2.6.1] 마이스터디룸 조회 (스터디룸 이름, 종료여부)
SELECT sr.name, if(sr.is_finished, 'end (종료)', 'proceeding (진행중)') AS '종료여부'
FROM study_room_member srm
INNER JOIN user u ON u.user_id = srm.user_id
INNER JOIN study_room sr ON sr.study_room_id = srm.study_room_id
WHERE u.username = 'starla'
;

-- [2.6.2] 마이 스터디룸 상세 조회 (스룸 이름, 소개, 카테고리명, 스터디 최대인원, 시작/끝 날짜)
-- 뷰 생성
CREATE VIEW my_study_room_view AS
SELECT u.username,
		 sr.name AS 'study_group_name', 
		 src.name AS 'category',
		 sr.description,
		 sr.max_capacity,
		 sr.start_date_time,
		 sr.end_date_time,
		 srmem.is_join_accepted,
		 sr.is_finished
FROM study_room_member srmem
INNER JOIN user u ON u.user_id = srmem.user_id
INNER JOIN study_room sr ON sr.study_room_id = srmem.study_room_id
INNER JOIN study_room_category src ON src.study_room_category_id = sr.study_room_category_id
WHERE srmem.is_join_accepted = TRUE
;

SELECT * FROM my_study_room_view
where username = 'starla'
AND study_group_name = '자바로 알고리즘 공부하기'
;


-- 스터디룸 참가중인 인원

SELECT sr.name, COUNT(*) AS '참가인원', sr.max_capacity AS '최대인원'
FROM study_room_member srmem
INNER JOIN study_room sr ON sr.study_room_id = srmem.study_room_id
WHERE srmem.is_join_accepted = TRUE
GROUP BY sr.name
HAVING sr.name = (SELECT sr.name FROM study_room_member srmem
											INNER JOIN user u ON u.user_id = srmem.user_id
											INNER JOIN study_room sr ON sr.study_room_id = srmem.study_room_id
						WHERE u.username = 'starla')
;


```

</div>
</details>

<details>
<summary>스터디룸 퇴장</summary>
<div markdown="1">

```sql

-- [2.7.1] 스터디룸 퇴장
-- is_join_accept를 false로 바꾸고, 권한 없애기
UPDATE study_room_member
SET is_join_accepted = false, privilege = null
WHERE user_id = (
						SELECT user_id FROM user
						WHERE username = 'starla'
					)
AND privilege = 'member'
;

-- [2.7.2] 스터디룸 부원 강퇴
-- starla가 방장이라면 luther을 자바로 알고리즘 공부하기에서 강퇴
DELIMITER $

CREATE OR REPLACE PROCEDURE outMemberProc(
    IN MEMBER VARCHAR(15),
    IN study_group VARCHAR(30)
)
BEGIN
    DECLARE manager_check BOOLEAN;

    -- starla가 방장인지 확인 (맞으면 true, 아니면 false 반환) -> bool값을 manager_check 변수에 담음
    SELECT IF(privilege = 'manager', TRUE, FALSE)
    INTO manager_check
    FROM study_room_member
    WHERE user_id = (
        SELECT user_id FROM user
        WHERE username = 'starla'
    );

    -- 방장이라면, 부원의 권한을 null로, 참가여부를 false로 바꿈으로써 탈퇴
    IF manager_check THEN
        UPDATE study_room_member
        SET is_join_accepted = FALSE, privilege = NULL
        WHERE user_id = (
            SELECT user_id FROM user
            WHERE username = MEMBER
        )
        AND study_room_id = (
            SELECT study_room_id FROM study_room
            WHERE name = study_group
        );
    END IF;
END $

DELIMITER ;

CALL outMemberProc('luther','자바로 알고리즘 공부하기');

```

</div>
</details>

<details>
<summary>스터디룸 방장 권한 위임</summary>
<div markdown="1">

```sql

-- 1번 스터디룸 방장인 1번 유저가 3번유저에게 방장 위임
UPDATE study_room_member
SET privilege = 'member'
WHERE user_id = (SELECT user_id FROM `user` WHERE nickname = 'Luisetti') 
AND privilege = 'manager';

UPDATE study_room_member
	SET privilege = 'MANAGER'
 WHERE user_id = 
 (SELECT user_id FROM `user` WHERE nickname = 'Fliege') 
;

```

</div>
</details>

> ## **주간 계획**
<details>
<summary>주간 계획 생성</summary>
<div markdown="1">

```sql

# [3.1.1] [주간 계획 생성] T
-- 12번 user (hoya) 새로운 1주차 주간계획 생성
INSERT INTO study_room_member_weekly_plan (study_room_id, study_room_member_id, plan_detail, created_date_time, weekly_plan_round_number) VALUES
(1, 12, 'solveSQL 5문제풀기', '2024-06-01 12:00:00', 1);

-- 생성 후 생성된 내용 화면에 띄우기 위해 조회
SELECT u.nickname,
		 r.`name`,
		 wp.weekly_plan_round_number,
		 wp.plan_detail,
		 wp.created_date_time
FROM study_room_member_weekly_plan wp
INNER JOIN study_room r ON wp.study_room_id = r.study_room_id
INNER JOIN study_room_member m ON wp.study_room_member_id = m.study_room_member_id
INNER JOIN `user` u ON m.user_id = u.user_id
WHERE wp.study_room_member_id = 12;

```

</div>
</details>

<details>
<summary>주간 계획 조회</summary>
<div markdown="1">

```sql

# [3.2.1] [주간 계획 조회] T

-- (Luisetti가 로그인 상태) 내 주간계획 조회
SELECT wp.weekly_plan_round_number,
		 wp.plan_detail,
		 wp.created_date_time
FROM study_room_member_weekly_plan wp
INNER JOIN study_room r ON wp.study_room_id = r.study_room_id
INNER JOIN study_room_member m ON wp.study_room_member_id = m.study_room_member_id
INNER JOIN `user` u ON m.user_id = u.user_id
WHERE wp.study_room_member_id = (SELECT srm.study_room_member_id
											FROM study_room_member srm
											INNER JOIN `user` u ON srm.user_id = u.user_id 
											WHERE u.nickname = 'Luisetti');

# [3.2.1] - 2  [같은 스터디룸 안의 주간 계획 조회] T

-- (Luisetti가 로그인 상태) 내가 참여하고 있는 스터디룸에서 다른 사람 주간계획 조회

-- 내가 참여하고 있는 스터디룸의 참가자들 띄우기
CREATE OR REPLACE VIEW my_study_room_members_view AS 
SELECT u.nickname
FROM study_room_member srm
INNER JOIN `user` u ON u.user_id = srm.user_id
INNER JOIN study_room sr ON sr.study_room_id = srm.study_room_id
WHERE srm.is_join_accepted = TRUE
AND 	sr.study_room_id = (SELECT srm.study_room_id 
									 FROM  study_room_member srm
									 INNER JOIN `user` u ON u.user_id = srm.user_id
									 WHERE nickname = 'Luisetti')
;

SELECT * FROM my_study_room_members_view;
;


-- 같은 스터디룸에 있는 Fliege의 주간 계획 보러 가기
DELIMITER $$
CREATE OR REPLACE PROCEDURE search_weekly_plan(
	IN clicked_nickname VARCHAR(10)
)
BEGIN 
	SELECT wp.weekly_plan_round_number,
			 wp.plan_detail,
			 wp.created_date_time
	FROM study_room_member_weekly_plan wp
	INNER JOIN study_room r ON wp.study_room_id = r.study_room_id
	INNER JOIN study_room_member m ON wp.study_room_member_id = m.study_room_member_id
	INNER JOIN `user` u ON m.user_id = u.user_id
	WHERE wp.study_room_member_id = (SELECT srm.study_room_member_id
												FROM study_room_member srm
												INNER JOIN `user` u ON srm.user_id = u.user_id 
												WHERE u.nickname = clicked_nickname);
END $$
DELIMITER ;

CALL search_weekly_plan('Fliege');
```

</div>
</details>

<details>
<summary>이전 시간대 주간 계획 수정 경고 처리</summary>
<div markdown="1">

```sql

# [3.5.1] [주간 계획 수정하기] T
-- 날짜 지나면 수정 못하게 하기

-- 이전 시간대 주간 계획 수정 시 경고 메세지 출력
DELIMITER $$

CREATE OR REPLACE TRIGGER update_time_check BEFORE UPDATE ON study_room_member_weekly_plan
FOR EACH ROW
BEGIN
    IF OLD.created_date_time < NOW() THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = '현재 시간보다 이전일 주간계획은 수정할 수 없습니다.';
    END IF;
END $$

DELIMITER ;

-- 46번 'SQL SOLVE 100~105번 풀기'로 수정
UPDATE study_room_member_weekly_plan
SET plan_detail = 'SQL SOLVE 100~105번 풀기',
	 created_date_time = NOW()
WHERE study_room_member_weekly_plan_id = 46;

-- 46번 'SQL SOLVE 100~105번 풀기'로 수정
UPDATE study_room_member_weekly_plan
SET plan_detail = 'SQL SOLVE 100~105번 풀기',
	 created_date_time = NOW()
WHERE study_room_member_weekly_plan_id = 6;

```

</div>
</details>

<details>
<summary>주간 계획 피드백</summary>
<div markdown="1">

```sql

# [3.3.1] [주간 계획 피드백 추가] T
INSERT INTO study_room_member_weekly_plan_evaluation (study_room_member_weekly_plan_id,
																		study_room_member_id,
																		evaluation_date_time,
																		evaluation_icon) VALUES
(1,12,'2024-06-01 10:50:12','A');

SELECT * FROM study_room_member_weekly_plan_evaluation
ORDER BY study_room_member_weekly_plan_evaluation_id DESC
LIMIT 1;

# [3.3.1] - 2 [주간 계획 피드백 수정] T

-- 1번 유저가 3번 유저 주간계획 평가 이모지바꾸기 
UPDATE study_room_member_weekly_plan_evaluation
	SET evaluation_date_time = NOW(),
		 evaluation_icon = 'C'
 WHERE study_room_member_id = 1;

```

</div>
</details>

> ## **투 두 리스트**
<details>
<summary>투 두 리스트 생성 및 조회</summary>
<div markdown="1">

```sql

USE study_hour;

# 투 두 테스트를 위한 프로시저
DELIMITER $$
CREATE OR REPLACE PROCEDURE SELECT_TODO_ALL()
BEGIN
    SELECT r.name                                 AS '스터디룸',
           u.username                             AS '작성자',
           to_do.content                          AS '내용',
           to_do.created_date                     AS '작성일',
           IF(is_checked, 'CHECKED', 'UNCHECKED') AS '체크_여부'
    FROM STUDY_ROOM_MEMBER_TODO to_do
             INNER JOIN STUDY_ROOM_MEMBER m ON to_do.study_room_member_id = m.study_room_member_id
             INNER JOIN STUDY_ROOM r ON m.study_room_id = r.study_room_id
             INNER JOIN USER u ON m.user_id = u.user_id
    ORDER BY r.name;
END $$

DELIMITER ;

DELIMITER $$
CREATE OR REPLACE PROCEDURE SELECT_TODO_BY_USERNAME(
    IN USERNAME VARCHAR(15)
)
BEGIN
    SELECT r.name                                 AS '스터디룸',
           u.username                             AS '작성자',
           to_do.content                          AS '내용',
           to_do.created_date                     AS '작성일',
           IF(is_checked, 'CHECKED', 'UNCHECKED') AS '체크_여부'
    FROM STUDY_ROOM_MEMBER_TODO to_do
             INNER JOIN STUDY_ROOM_MEMBER m ON to_do.study_room_member_id = m.study_room_member_id
             INNER JOIN STUDY_ROOM r ON m.study_room_id = r.study_room_id
             INNER JOIN USER u ON m.user_id = u.user_id
    WHERE u.username = USERNAME
    ORDER BY r.name;
END $$
DELIMITER ;

# [4.1.1] [투 두 리스트 내용 입력] T
-- Giselbert 가 스터디룸 1번에서 투 두 리스트 작성
INSERT INTO STUDY_ROOM_MEMBER_TODO (study_room_member_id, content, created_date)
    VALUE (3, '투 두 리스트 작성 테스트', CURDATE());

CALL SELECT_STUDY_ROOM_MEMBER_TODO_BY_USERNAME('Giselbert');
# [4.2.1] [투 두 리스트 조회] T
-- 전체 스터디룸 내 모든 투 두 리스트 조회
CALL SELECT_STUDY_ROOM_MEMBER_TODO_ALL();

-- 유저 아이디 'Giselbert'가 작성한 투 두 리스트 조회
CALL SELECT_STUDY_ROOM_MEMBER_TODO_BY_USERNAME('Giselbert');

```

</div>
</details>

<details>
<summary>투 두 리스트 수정</summary>
<div markdown="1">

```sql

# [4.3.1] [투 두 리스트 수정] T
-- 유저 아이디 'Giselbert'가 작성한 투 두 리스트 수정
UPDATE STUDY_ROOM_MEMBER_TODO
SET content = '투 두 리스트 수정 테스트'
WHERE study_room_member_id = (SELECT study_room_member_id
                              FROM STUDY_ROOM_MEMBER m
                                       INNER JOIN USER u ON m.user_id = u.user_id
                              WHERE u.username = 'Giselbert');

CALL SELECT_STUDY_ROOM_MEMBER_TODO_BY_USERNAME('Giselbert');

```

</div>
</details>

<details>
<summary>투 두 리스트 삭제</summary>
<div markdown="1">

```sql

# [4.4.1] [투 두 리스트 삭제] T
-- 유저 아이디 'Giselbert' 가 작성한 투 두 리스트 수정
UPDATE STUDY_ROOM_MEMBER_TODO
SET content = '투 두 리스트 수정 테스트'
WHERE study_room_member_todo_id = (SELECT to_do.study_room_member_todo_id
                                   FROM STUDY_ROOM_MEMBER_TODO to_do
                                            INNER JOIN STUDY_ROOM_MEMBER m
                                                       ON to_do.study_room_member_id = m.study_room_member_id
                                            INNER JOIN STUDY_ROOM r ON m.study_room_id = r.study_room_id
                                            INNER JOIN USER u ON m.user_id = u.user_id
                                   WHERE u.username = 'Giselbert'
                                   ORDER BY to_do.created_date
                                   LIMIT 1);

CALL SELECT_STUDY_ROOM_MEMBER_TODO_BY_USERNAME('Giselbert');
-- 처음으로 작성된 투 두 리스트 제거
DELETE
FROM STUDY_ROOM_MEMBER_TODO
WHERE study_room_member_todo_id = (SELECT to_do.study_room_member_todo_id
                                   FROM STUDY_ROOM_MEMBER_TODO to_do
                                            INNER JOIN STUDY_ROOM_MEMBER m
                                                       ON to_do.study_room_member_id = m.study_room_member_id
                                            INNER JOIN STUDY_ROOM r ON m.study_room_id = r.study_room_id
                                            INNER JOIN USER u ON m.user_id = u.user_id
                                   WHERE u.username = 'Giselbert'
                                   ORDER BY to_do.created_date
                                   LIMIT 1);

CALL SELECT_STUDY_ROOM_MEMBER_TODO_BY_USERNAME('Giselbert');

```

</div>
</details>

> ## **인증**
<details>
<summary>인증 여부 확인 프로시저 생성</summary>
<div markdown="1">

```sql

USE study_hour;

DELIMITER $$
CREATE OR REPLACE PROCEDURE SELECT_VERIFICATION_BY_USERNAME(
    USERNAME VARCHAR(15)
)
BEGIN
    SELECT u.username    AS '작성자',
           p.plan_detail AS '계획',
           v.image_url   AS '인증 사진'
    FROM STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION v
             INNER JOIN STUDY_ROOM_MEMBER_WEEKLY_PLAN p
                        ON v.study_room_member_weekly_plan_id = p.study_room_member_weekly_plan_id
             INNER JOIN STUDY_ROOM_MEMBER m ON p.study_room_member_id = m.study_room_member_id
             INNER JOIN USER u ON m.user_id = u.user_id
    WHERE u.username = USERNAME;
END $$
DELIMITER ;

DELIMITER $$
CREATE OR REPLACE PROCEDURE SELECT_VERIFICATION_EXIST_BY_ROOM_NAME_AND_USERNAME_AND_DURATION(
    STUDY_ROOM_NAME VARCHAR(30),
    USERNAME VARCHAR(15),
    STUDY_ROOM_DURATION INT
)
BEGIN
    SELECT r.name                             AS '스터디룸',
           u.username                         AS '작성자',
           p.plan_detail                      AS '계획',
           p.weekly_plan_round_number         AS '주차',
           NVL2(p.plan_duration, '인증', '미인증') AS '시간_인증_여부',
           NVL2(v.image_url, '인증', '미인증')     AS '사진_인증_여부'
    FROM STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION v
             RIGHT JOIN STUDY_ROOM_MEMBER_WEEKLY_PLAN p
                        ON v.study_room_member_weekly_plan_id = p.study_room_member_weekly_plan_id
             INNER JOIN STUDY_ROOM r ON p.study_room_id = r.study_room_id
             INNER JOIN STUDY_ROOM_MEMBER m ON p.study_room_member_id = m.study_room_member_id
             INNER JOIN USER u ON u.user_id = m.user_id
    WHERE r.name = STUDY_ROOM_NAME
      AND p.weekly_plan_round_number = STUDY_ROOM_DURATION
      AND u.username = USERNAME;
END $$
DELIMITER ;

```

</div>
</details>

<details>
<summary>인증</summary>
<div markdown="1">

```sql

# [5.1.1] [타이머 인증]
-- Study Room 1번에 참가한 'Giselbert' 유저 계획 시간 업데이트
UPDATE STUDY_ROOM_MEMBER_WEEKLY_PLAN
SET plan_duration = (plan_duration + 10000)
WHERE study_room_member_weekly_plan_id = 2;

SELECT *
FROM STUDY_ROOM_MEMBER_WEEKLY_PLAN p
         INNER JOIN STUDY_ROOM r ON p.study_room_id = r.study_room_id
         INNER JOIN STUDY_ROOM_MEMBER m ON p.study_room_member_id = m.study_room_member_id
         INNER JOIN USER u On m.user_id = u.user_id
WHERE username = 'Giselbert';

# [5.1.2] [사진 인증]
UPDATE STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION
SET image_url = '사진 인증 테스트'
WHERE study_room_member_weekly_plan_id = 2;

```

</div>
</details>

<details>
<summary>스터디원 인증 여부 조회</summary>
<div markdown="1">

```sql

# [5.2.1] [스터디원 인증 여부 조회]
# Study Room 1번 2주차 인증여부 조회
CALL SELECT_VERIFICATION_EXIST_BY_ROOM_NAME_AND_USERNAME_AND_DURATION('자바로 알고리즘 공부하기', 'Giselbert', 2);

```

</div>
</details>

<details>
<summary>인증 수정</summary>
<div markdown="1">

```sql

# [5.3.1] [인증 수정]
# 인증 사진 수정
UPDATE STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION
SET image_url = '사진 인증 수정 테스트'
WHERE study_room_member_weekly_plan_id = 2;

CALL SELECT_VERIFICATION_BY_USERNAME('Giselbert');

```

</div>
</details>

<details>
<summary>인증 삭제</summary>
<div markdown="1">

```sql

# [5.4.1] [인증 삭제]
-- DELETE PLAN_VERIFICATION_BY_USERNAME_AND_PLAN_DETAIL
DELETE
FROM STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION
WHERE study_room_member_weekly_plan_verification_id = (SELECT v.study_room_member_weekly_plan_verification_id
                                                       FROM STUDY_ROOM_MEMBER_WEEKLY_PLAN_VERIFICATION v
                                                                INNER JOIN STUDY_ROOM_MEMBER_WEEKLY_PLAN p
                                                                           ON v.study_room_member_weekly_plan_id = p.study_room_member_weekly_plan_id
                                                                INNER JOIN STUDY_ROOM_MEMBER m ON p.study_room_member_id = m.study_room_member_id
                                                                INNER JOIN USER u ON m.user_id = u.user_id
                                                       WHERE u.username = 'Giselbert'
                                                         AND p.plan_detail = '토익 단어 500개 외우기');

CALL SELECT_VERIFICATION_BY_USERNAME('Giselbert');

```

</div>
</details>

> ## **게시판**
<details>
<summary>게시글 작성</summary>
<div markdown="1">

```sql

# [6.1.1] [게시글 제목 작성] T
# [6.1.2] [게시글 내용 작성] T
-- 3번 참가자가 1번 스터디룸에 게시글 작성: (제목)테스트 게시글 작성해요 (내용)근데 이거 꼭 작성해야 하나요???

INSERT INTO study_room_board (study_room_id, study_room_member_id, title, content, created_date_time)
VALUES (1, 3, '테스트 게시글 작성해요', '근데 이거 꼭 작성해야 하나요???', '2024-06-09 13:00:12');


```

</div>
</details>

<details>
<summary>게시글 리스트 조회</summary>
<div markdown="1">

```sql

# [6.2.1] [게시글 리스트 조회] T
-- view) 1번 스터디룸 게시글 리스트 전체 조회: 제목, 작성자, 작성일 -> 최신순 정렬
-- * 입력받은 스터디룸 번호의 게시글 리스트 뷰를 select해서 반환하는 프로시저 생성
DELIMITER $$
CREATE OR REPLACE PROCEDURE board_list (
    IN id INT
)
BEGIN
	DECLARE v_sql_statement VARCHAR(500);
	SET v_sql_statement = CONCAT(
        'CREATE OR REPLACE VIEW v_study_room_board AS ',
        'SELECT title, content, b.username, created_date_time ',
        'FROM STUDY_ROOM_BOARD a ',
        'INNER JOIN (SELECT study_room_member_id, b.username ',
        '           FROM STUDY_ROOM_MEMBER a ',
        '           INNER JOIN USER b ON a.user_id = b.user_id) b ',
        'ON a.study_room_member_id = b.study_room_member_id ',
        'WHERE study_room_id = ', id,
        ' ORDER BY created_date_time DESC'
    );
	PREPARE stmt FROM v_sql_statement;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
END $$
DELIMITER ;

CALL board_list(1);

```

</div>
</details>

<details>
<summary>상세 게시글 조회</summary>
<div markdown="1">

```sql

# [6.2.2] [게시글 상세 조회] T
-- 9번 게시글(1번 스터디룸의 6번째)을 조회: 제목, 내용, 작성자, 작성일
SELECT title, content, b.username, created_date_time
FROM STUDY_ROOM_BOARD a LEFT JOIN (SELECT study_room_member_id, b.username 
	FROM STUDY_ROOM_MEMBER a LEFT JOIN USER b ON a.user_id = b.user_id) b
ON a.study_room_member_id = b.study_room_member_id
WHERE title = '한화 코테 준비';

-- 삭제된 회원의 게시글을 조회: 제목, 내용, 작성자, 작성일 -> 작성자: 탈퇴회원_nn
SELECT title, content, b.username, created_date_time
FROM STUDY_ROOM_BOARD a LEFT JOIN (SELECT study_room_member_id, b.username 
	FROM STUDY_ROOM_MEMBER a LEFT JOIN USER b ON a.user_id = b.user_id) b
ON a.study_room_member_id = b.study_room_member_id
WHERE b.username LIKE '탈퇴*';

```

</div>
</details>

<details>
<summary>게시글 수정 및 삭제</summary>
<div markdown="1">

```sql

# [6.3] [게시판 수정]
# [6.3.1] [게시글 수정] T
-- 9번 게시글(1번 스터디룸의 6번째)의 내용 수정
UPDATE STUDY_ROOM_BOARD
SET title = '게시글 수정 테스트합니다',
	content = '내용도 수정한거 아세요? 날짜도 변경됩니다.',
	created_date_time = NOW()
WHERE study_room_board_id = 9;

-- 게시글 수정된 내용 조회(이전 게시글 제목으로는 조회 안됨, 게시글 식별자로 수정 내용 확인)
SELECT title, content, b.username, created_date_time
FROM STUDY_ROOM_BOARD a LEFT JOIN (SELECT study_room_member_id, b.username 
	FROM STUDY_ROOM_MEMBER a LEFT JOIN USER b ON a.user_id = b.user_id) b
ON a.study_room_member_id = b.study_room_member_id
WHERE title = '한화 코테 준비';

SELECT title, content, b.username, created_date_time
FROM STUDY_ROOM_BOARD a LEFT JOIN (SELECT study_room_member_id, b.username 
	FROM STUDY_ROOM_MEMBER a LEFT JOIN USER b ON a.user_id = b.user_id) b
ON a.study_room_member_id = b.study_room_member_id
WHERE study_room_board_id = 9;

# [6.4] [게시판 삭제]
# [6.4.1] [게시글 삭제하기] T
-- 4번 게시글(1번 스터디룸의 3번째) delete 후 view 조회하여 삭제 확인: 6.3.1 테스트 수정 내용도 같이 대략적 확인
-- * 게시글을 삭제하려면 외래키 제약에 의해 해당 댓글을 먼저 전부 삭제하고, 게시글을 삭제하는 작업을 거쳐야 함
-- * 두 작업을 한 번에 처리하기 위해, 프로시저 사용

DELIMITER $$
CREATE PROCEDURE delete_board (
	IN board_id INT
)
BEGIN
	DELETE FROM STUDY_ROOM_BOARD_COMMENT
	WHERE study_room_board_id = board_id;

	DELETE FROM STUDY_ROOM_BOARD
	WHERE study_room_board_id = board_id;
END $$
DELIMITER;

CALL delete_board(4)
CALL board_list(1)

```

</div>
</details>

<details>
<summary>댓글 작성 및 조회</summary>
<div markdown="1">

```sql

# [6.5.1] [댓글 작성하기] T
-- 28번 게시글(2번 스터디룸의 14번째)에 7번 참가자가 댓글 작성
INSERT INTO study_room_board_comment (study_room_board_id, study_room_member_id, content, created_date_time)
VALUES (28, 7, '테스트 댓글을 작성할거에요.', NOW());

# [6.5.2] [댓글 조회하기] T
-- 28번 게시글(2번 스터디룸의 14번째)의 '제목'으로 댓글 조회
-- 게시글 제목으로 댓글을 조회하는 프로시저 생성, 조회 조건: (게시글)제목, 내용, 작성자, 작성일 (댓글)작성자, 내용, 작성일
DELIMITER $$
CREATE OR REPLACE PROCEDURE board_comment (
    IN board_title VARCHAR(100)
)
BEGIN
	SELECT c.username, a.content, a.created_date_time
    FROM STUDY_ROOM_BOARD_COMMENT a
    LEFT JOIN STUDY_ROOM_BOARD b ON a.study_room_board_id = b.study_room_board_id
    LEFT JOIN (SELECT study_room_member_id, b.username 
	    FROM STUDY_ROOM_MEMBER a LEFT JOIN USER b ON a.user_id = b.user_id) c ON a.study_room_member_id = c.study_room_member_id
    WHERE b.title = board_title;
END $$
DELIMITER ;

CALL board_comment('고등학교 수학 완전정복');

```

</div>
</details>

<details>
<summary>댓글 수정 및 삭제</summary>
<div markdown="1">

```sql

# [6.5.3] [댓글 삭제하기] T
-- 'Ellary'유저(10번 참가자)가 자신의 댓글을 모두 삭제
-- 전체 댓글 중 'Ellary'가 작성한 댓글 조회해서 확인
DELETE FROM STUDY_ROOM_BOARD_COMMENT
WHERE study_room_member_id = 10;

SELECT c.username, a.content, a.created_date_time
FROM STUDY_ROOM_BOARD_COMMENT a
LEFT JOIN STUDY_ROOM_BOARD b ON a.study_room_board_id = b.study_room_board_id
LEFT JOIN (SELECT study_room_member_id, b.username 
	FROM STUDY_ROOM_MEMBER a LEFT JOIN USER b ON a.user_id = b.user_id) c ON a.study_room_member_id = c.study_room_member_id
WHERE c.username = 'Ellary';

# [6.5.4] [댓글 수정하기] T
-- 28번 게시글(2번 스터디룸의 14번째)에서 'Betti'유저(6번 참가자)가 댓글 수정
-- 28번 게시글 조회해서 수정된 댓글 확인('Ellary'의 삭제된 댓글도 같이 확인)
UPDATE STUDY_ROOM_BOARD_COMMENT
SET content = '조금씩 아니고 대폭 나아지고 있어요.',
	create_date_time = NOW()
WHERE study_room_board_id = 28 AND study_room_member_id = 6;

CALL board_comment('고등학교 수학 완전정복');

```

</div>
</details>


> ## **벌금**
<details>
<summary>벌금 액수 집계</summary>
<div markdown="1">

```sql

-- 스터디룸 생성 시 입력되었던 인증 주기(1주 기준), 인증 방법, 벌금 정보를 바탕으로 액수가 집계된다.
SELECT 
    sr.study_room_id,
    sr.authentication_method,
    sr.fine,
    COUNT(DISTINCT srm.study_room_member_id) AS total_members,
    SUM(CASE WHEN ss.attendance = 'PRESENT' THEN 1 ELSE 0 END) AS total_attended_rounds,
    SUM(CASE WHEN ss.todo_achievement = 'ACHIEVED' THEN 1 ELSE 0 END) AS total_achieved_todos,
    SUM(CASE WHEN ss.pay_fine = '12000' THEN 1 ELSE 0 END) AS total_fined_rounds,
    SUM(CASE WHEN ss.pay_fine = '12000' THEN srmf.fine_amount ELSE 0 END) AS total_fine_amount
FROM 
    STUDY_ROOM sr
LEFT JOIN 
    STUDY_ROOM_MEMBER srm ON sr.study_room_id = srm.study_room_id
LEFT JOIN 
    STATISTICS ss ON sr.study_room_id = ss.study_room_id
LEFT JOIN 
    STUDY_ROOM_MEMBER_FINE srmf ON srm.study_room_member_id = srmf.study_room_member_id
GROUP BY 
    sr.study_room_id, sr.authentication_method, sr.fine;
    

SELECT * FROM statistics;

```

</div>
</details>

<details>
<summary>성취도와 회차에 따른 벌금 액수 집계</summary>
<div markdown="1">

```sql

-- 벌금은 기간 단위 내 스터디원 성취 여부를 기준으로 70% 이하 성취 시 집계되어야 한다.
SELECT 
    sr.study_room_id,
    sr.authentication_method,
    sr.fine,
    COUNT(DISTINCT srm.study_room_member_id) AS total_members,
    SUM(CASE WHEN ss.attendance = 'PRESENT' THEN 1 ELSE 0 END) AS total_attended_rounds,
    SUM(CASE WHEN ss.todo_achievement = 'ACHIEVED' THEN 1 ELSE 0 END) AS total_achieved_todos,
    SUM(CASE WHEN ss.pay_fine = '12000' THEN 1 ELSE 0 END) AS total_fined_rounds,
    SUM(CASE WHEN ss.pay_fine = '12000' AND 
        (SELECT 
            COUNT(*) 
        FROM 
            STATISTICS 
        WHERE 
            study_room_id = sr.study_room_id 
            AND todo_achievement = 'ACHIEVED'
            AND pay_fine = '12000'
        ) / NULLIF(
            (SELECT 
                COUNT(*) 
            FROM 
                STATISTICS 
            WHERE 
                study_room_id = sr.study_room_id 
                AND pay_fine = 'YES'
            ), 0) <= 0.7 THEN 1 ELSE 0 END) AS total_fined_due_to_achievement_rate,
    SUM(CASE WHEN ss.pay_fine = 'YES' THEN srmf.fine_amount ELSE 0 END) AS total_fine_amount
FROM 
    STUDY_ROOM sr
LEFT JOIN 
    STUDY_ROOM_MEMBER srm ON sr.study_room_id = srm.study_room_id
LEFT JOIN 
    STATISTICS ss ON sr.study_room_id = ss.study_room_id
LEFT JOIN 
    STUDY_ROOM_MEMBER_FINE srmf ON srm.study_room_member_id = srmf.study_room_member_id
GROUP BY 
    sr.study_room_id, sr.authentication_method, sr.fine;


-- 집계된 벌금 액수는 주간 단위 다음날 05:00 기준으로 계산되어야 한다.
 SELECT *
FROM STUDY_ROOM_MEMBER_FINE
WHERE DATE_ADD(NOW(), INTERVAL 1 WEEK) >= DATE_FORMAT(NOW(), '%Y-%m-%d 05:00:00');



-- 집계된 벌금 액수는 주간 단위 기준으로 초기화되어야 한다.
UPDATE STUDY_ROOM_MEMBER_FINE
SET fine_amount = 0
WHERE DAYOFWEEK(NOW()) = 2 AND HOUR(NOW()) = 5; -- 월요일 오전 5시


-- STUDY_ROOM_MEMBER_FINE 테이블에 더미 데이터 삽입
INSERT INTO STUDY_ROOM_MEMBER_FINE (study_room_member_id, get_fine_round, fine_amount)
VALUES 
    (1, 1, 100),
    (2, 1, 200),
    (3, 1, 0),
    (4, 1, 300);

-- 주간 벌금 초기화 쿼리를 실행하기 전에 현재 STUDY_ROOM_MEMBER_FINE 테이블의 데이터 출력
SELECT * FROM STUDY_ROOM_MEMBER_FINE;

-- 주간 벌금 초기화 쿼리 실행
UPDATE STUDY_ROOM_MEMBER_FINE
SET fine_amount = 0
WHERE DAYOFWEEK(NOW()) = 2 AND HOUR(NOW()) = 5; -- 월요일 오전 5시

-- 주간 벌금 초기화 후 STUDY_ROOM_MEMBER_FINE 테이블의 데이터 출력
SELECT * FROM STUDY_ROOM_MEMBER_FINE;

-- 주간 벌금 액수가 주간 단위 다음날 05:00 기준으로 계산되는지 확인하는 쿼리
SELECT *
FROM STUDY_ROOM_MEMBER_FINE
WHERE DATE_ADD(NOW(), INTERVAL 1 WEEK) >= DATE_FORMAT(NOW(), '%Y-%m-%d 05:00:00');

```

</div>
</details>

<details>
<summary>벌금 대상 집계</summary>
<div markdown="1">

```sql

-- 스터디룸 생성 시 입력되었던 인증 주기, 인증 방법 정보를 바탕으로 대상을 집계한다.
SELECT 
    sr.study_room_id,
    sr.authentication_method,
    COUNT(DISTINCT srm.study_room_member_id) AS total_members
FROM 
    STUDY_ROOM sr
LEFT JOIN 
    STUDY_ROOM_MEMBER srm ON sr.study_room_id = srm.study_room_id
GROUP BY 
    sr.study_room_id, sr.authentication_method;

```

</div>
</details>

<details>
<summary>성취도와 회차에 따른 벌금 대상 집계</summary>
<div markdown="1">

```sql

-- 벌금 대상은 기간 단위 내 스터디원 성취 여부를 기준으로 70% 이하 성취 시 집계되어야 한다.
SELECT 
    sr.study_room_id,
    COUNT(DISTINCT srm.study_room_member_id) AS total_members,
    SUM(CASE WHEN ss.todo_achievement = 'ACHIEVED' THEN 1 ELSE 0 END) AS total_achieved_todos,
    SUM(CASE WHEN ss.todo_achievement = 'ACHIEVED' THEN 1 ELSE 0 END) / NULLIF(COUNT(DISTINCT srm.study_room_member_id), 0) AS achievement_rate
FROM 
    STUDY_ROOM sr
LEFT JOIN 
    STUDY_ROOM_MEMBER srm ON sr.study_room_id = srm.study_room_id
LEFT JOIN 
    STATISTICS ss ON sr.study_room_id = ss.study_room_id
GROUP BY 
    sr.study_room_id
HAVING 
    achievement_rate <= 0.7;

-- 벌금 대상은 기간 단위 다음날 05:00시 기준으로 집계되어야 한다.
SELECT 
    sr.study_room_id,
    COUNT(DISTINCT srm.study_room_member_id) AS total_members
FROM 
    STUDY_ROOM sr
LEFT JOIN 
    STUDY_ROOM_MEMBER srm ON sr.study_room_id = srm.study_room_id
LEFT JOIN 
    STATISTICS ss ON sr.study_room_id = ss.study_room_id
WHERE 
    DATE_ADD(DATE_FORMAT(NOW(), '%Y-%m-%d 05:00:00'), INTERVAL 1 DAY) <= NOW()
GROUP BY 
    sr.study_room_id;



-- 벌금 대상은 기간 단위 기준으로 초기화되어야 한다.

-- 기간 단위로 초기화하는 쿼리 (예를 들어, 매주 월요일 오전 5시에 실행)
UPDATE 
    STUDY_ROOM_MEMBER_FINE
SET 
    fine_amount = 0
WHERE 
    DAYOFWEEK(NOW()) = 2 AND HOUR(NOW()) = 5; -- 월요일 오전 5시
   
-- 스터디룸 생성 시 입력되었던 인증 주기, 인증 방법 정보를 바탕으로 대상을 집계하는 테스트 케이스
SELECT 
    sr.study_room_id,
    sr.authentication_method,
    COUNT(DISTINCT srm.study_room_member_id) AS total_members
FROM 
    STUDY_ROOM sr
LEFT JOIN 
    STUDY_ROOM_MEMBER srm ON sr.study_room_id = srm.study_room_id
GROUP BY 
    sr.study_room_id, sr.authentication_method;

-- 벌금 대상은 기간 단위 내 스터디원 성취 여부를 기준으로 70% 이하 성취 시 집계되어야 한다.
SELECT 
    sr.study_room_id,
    COUNT(DISTINCT srm.study_room_member_id) AS total_members,
    SUM(CASE WHEN ss.todo_achievement = 'ACHIEVED' THEN 1 ELSE 0 END) AS total_achieved_todos,
    SUM(CASE WHEN ss.todo_achievement = 'ACHIEVED' THEN 1 ELSE 0 END) / NULLIF(COUNT(DISTINCT srm.study_room_member_id), 0) AS achievement_rate
FROM 
    STUDY_ROOM sr
LEFT JOIN 
    STUDY_ROOM_MEMBER srm ON sr.study_room_id = srm.study_room_id
LEFT JOIN 
    STATISTICS ss ON sr.study_room_id = ss.study_room_id
GROUP BY 
    sr.study_room_id
HAVING 
    achievement_rate <= 0.7;

-- 벌금 대상은 기간 단위 다음날 05:00시 기준으로 집계되어야 한다.
SELECT 
    sr.study_room_id,
    COUNT(DISTINCT srm.study_room_member_id) AS total_members
FROM 
    STUDY_ROOM sr
LEFT JOIN 
    STUDY_ROOM_MEMBER srm ON sr.study_room_id = srm.study_room_id
LEFT JOIN 
    STATISTICS ss ON sr.study_room_id = ss.study_room_id
WHERE 
    DATE_ADD(DATE_FORMAT(NOW(), '%Y-%m-%d 05:00:00'), INTERVAL 1 DAY) <= NOW()
GROUP BY 
    sr.study_room_id;

-- 벌금 대상은 기간 단위 기준으로 초기화되어야 한다.
-- 초기화 전
SELECT * FROM STUDY_ROOM_MEMBER_FINE;

-- 벌금 대상을 기간 단위로 초기화
UPDATE 
    STUDY_ROOM_MEMBER_FINE
SET 
    fine_amount = 0
WHERE 
    DAYOFWEEK(NOW()) = 2 AND HOUR(NOW()) = 5; -- 월요일 오전 5시

-- 초기화 후
SELECT * FROM STUDY_ROOM_MEMBER_FINE;

```

</div>
</details>

> ## **통계**
<details>
<summary>주간 계획 관련 통계</summary>
<div markdown="1">

```sql

-- 9.1.1 주간계획 총 개수 집계
-- ex : 자바로 알고리즘 공부하기 그룹 유저들의 1회차 주간계획 개수 출력
SELECT sr.name AS 'group name',
       u.username,
       COUNT(*) AS 'num of plan'
FROM study_room_member srm
INNER JOIN user u ON u.user_id = srm.user_id
INNER JOIN study_room_member_weekly_plan wp ON wp.study_room_member_id = srm.study_room_member_id
INNER JOIN study_room sr ON sr.study_room_id = srm.study_room_id
WHERE sr.name = '자바로 알고리즘 공부하기'
AND wp.weekly_plan_round_number = 1
AND srm.is_join_accepted = 1
GROUP BY sr.name, u.username
ORDER BY COUNT(*) DESC
;

-- 9.1.2 주간계획 총 소요시간 집계
-- sec_to_time 메소드 이용
SELECT sr.name AS 'group name',
       u.username,
       SEC_TO_TIME(SUM(wp.plan_duration)) AS 'total time'
FROM study_room_member srm
INNER JOIN user u ON u.user_id = srm.user_id
INNER JOIN study_room_member_weekly_plan wp ON wp.study_room_member_id = srm.study_room_member_id
INNER JOIN study_room sr ON sr.study_room_id = srm.study_room_id
WHERE sr.name = '자바로 알고리즘 공부하기'
AND wp.weekly_plan_round_number = 1
AND srm.is_join_accepted = 1
GROUP BY sr.name, u.username
ORDER BY COUNT(*) DESC
;

```

</div>
</details>

<details>
<summary>주간 계획 평가 관련 통계</summary>
<div markdown="1">

```sql

-- 9.2 주간 계획 평가 집계
-- 자바로~ 그룹의 1회차 주간 계획 평가개수
SELECT sr.name AS 'group name',
       u.username,
       COUNT(ev.study_room_member_weekly_plan_evaluation_id) AS 'num of evaluation'
FROM study_room_member srm
INNER JOIN user u ON u.user_id = srm.user_id
INNER JOIN study_room_member_weekly_plan wp ON wp.study_room_member_id = srm.study_room_member_id
INNER JOIN study_room sr ON sr.study_room_id = srm.study_room_id
INNER JOIN study_room_member_weekly_plan_evaluation ev ON ev.study_room_member_weekly_plan_id = wp.study_room_member_weekly_plan_id
WHERE sr.name = '자바로 알고리즘 공부하기'
AND wp.weekly_plan_round_number = 1
AND srm.is_join_accepted = 1
GROUP BY sr.name, u.username
ORDER BY 3 DESC;

```

</div>
</details>

<details>
<summary>벌금 관련 통계</summary>
<div markdown="1">

```sql

# 벌금 액수 집계 통계 쿼리(탈퇴 회원 제외, 동순위 rank)

use study_hour;

DELIMITER $$
CREATE OR REPLACE PROCEDURE SELECT_FINE_COUNT_RANK_BY_ROOM_ID (
    room_id INT
)
BEGIN
    SELECT c.username, get_fine_round, sum(fine_amount) as total_fine_amount, RANK() OVER (PARTITION BY get_fine_round ORDER BY sum(fine_amount) DESC) AS rank
    FROM STUDY_ROOM_MEMBER_FINE a
             INNER JOIN STUDY_ROOM_MEMBER b ON a.study_room_member_id = b.study_room_member_id
             INNER JOIN USER c ON b.user_id = c.user_id
    WHERE b.study_room_id = room_id AND c.username NOT LIKE '탈퇴*'
    GROUP BY c.username
    ORDER BY total_fine_amount DESC;
end $$
DELIMITER ;

CALL SELECT_FINE_COUNT_RANK_BY_ROOM_ID(1);

```

</div>
</details>

<details>
<summary>게시글 관련 통계</summary>
<div markdown="1">

```sql

use study_hour;

# 스터디룸 내 게시글 작성 개수 순위
DELIMITER $$
CREATE OR REPLACE PROCEDURE SELECT_BOARD_COUNT_RANK_BY_ROOM_ID(
    ROOM_ID int
)
BEGIN
    SELECT u.username                           AS '작성자',
           COUNT(*)                             AS '작성_개수',
           RANK() over (ORDER BY COUNT(*) DESC) AS '게시글_작성_개수_순위'
    FROM STUDY_ROOM_BOARD b
             INNER JOIN STUDY_ROOM_MEMBER m ON b.study_room_member_id = m.study_room_member_id
             INNER JOIN USER u ON m.user_id = u.user_id
    WHERE m.study_room_id = ROOM_ID
      AND u.username NOT LIKE '탈퇴%'
      AND u.nickname NOT LIKE '탈퇴%'
    GROUP BY u.username
    ORDER BY '게시글_작성_개수_순위';
end $$
DELIMITER ;

CALL SELECT_BOARD_COUNT_RANK_BY_ROOM_ID(1);

```

</div>
</details>

<details>
<summary>댓글 관련 통계</summary>
<div markdown="1">

```sql

USE study_hour;

# 스터디룸에서 댓글을 단 사람 순위
DELIMITER $$
CREATE OR REPLACE PROCEDURE SELECT_COMMENT_COUNT_RANK_BY_ROOM_ID(
    ROOM_ID INT
)
BEGIN
    SELECT u.username                           AS '유저_아이디',
           RANK() over (ORDER BY COUNT(*) DESC) AS '댓글_작성_개수_순위'
    FROM STUDY_ROOM_BOARD_COMMENT c
             INNER JOIN STUDY_ROOM_BOARD b ON c.study_room_board_id = b.study_room_board_id
             INNER JOIN STUDY_ROOM_MEMBER m ON c.study_room_member_id = m.study_room_member_id
             INNER JOIN USER u ON m.user_id = u.user_id
    WHERE m.study_room_id = ROOM_ID
      AND u.username NOT LIKE '탈퇴%'
      AND u.nickname NOT LIKE '탈퇴%'
    GROUP BY u.username;
end $$
DELIMITER ;

CALL SELECT_COMMENT_COUNT_RANK_BY_ROOM_ID(1);

CALL SELECT_COMMENT_COUNT_RANK_BY_ROOM_ID(2);

```

</div>
</details>
